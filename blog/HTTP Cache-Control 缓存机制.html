<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HTTP Cache-Control 缓存机制 | caihai123</title>
    <meta name="generator" content="VuePress 1.8.1">
    <script src="/documents/static/js/clicklove.js"></script>
    <meta name="description" content="个人在线文档">
    
    <link rel="preload" href="/documents/assets/css/0.styles.db21a181.css" as="style"><link rel="preload" href="/documents/assets/js/app.4f2ed955.js" as="script"><link rel="preload" href="/documents/assets/js/2.e76dce23.js" as="script"><link rel="preload" href="/documents/assets/js/21.9de72aab.js" as="script"><link rel="prefetch" href="/documents/assets/js/10.60030ce1.js"><link rel="prefetch" href="/documents/assets/js/11.25ae8904.js"><link rel="prefetch" href="/documents/assets/js/12.db0a5c21.js"><link rel="prefetch" href="/documents/assets/js/13.f5551591.js"><link rel="prefetch" href="/documents/assets/js/14.f408067b.js"><link rel="prefetch" href="/documents/assets/js/15.23bbd255.js"><link rel="prefetch" href="/documents/assets/js/16.626d0906.js"><link rel="prefetch" href="/documents/assets/js/17.1e984671.js"><link rel="prefetch" href="/documents/assets/js/18.1217a96d.js"><link rel="prefetch" href="/documents/assets/js/19.8083d39d.js"><link rel="prefetch" href="/documents/assets/js/20.f711d207.js"><link rel="prefetch" href="/documents/assets/js/22.78b12ed2.js"><link rel="prefetch" href="/documents/assets/js/23.fb07aed4.js"><link rel="prefetch" href="/documents/assets/js/24.b047b997.js"><link rel="prefetch" href="/documents/assets/js/25.0583b41b.js"><link rel="prefetch" href="/documents/assets/js/26.5c57f31b.js"><link rel="prefetch" href="/documents/assets/js/27.7d29e838.js"><link rel="prefetch" href="/documents/assets/js/28.358631e5.js"><link rel="prefetch" href="/documents/assets/js/29.30eb2dfd.js"><link rel="prefetch" href="/documents/assets/js/3.8fd369df.js"><link rel="prefetch" href="/documents/assets/js/30.9b173383.js"><link rel="prefetch" href="/documents/assets/js/31.3fdd407f.js"><link rel="prefetch" href="/documents/assets/js/32.0d4f71ba.js"><link rel="prefetch" href="/documents/assets/js/33.fe652afd.js"><link rel="prefetch" href="/documents/assets/js/34.b55b1a28.js"><link rel="prefetch" href="/documents/assets/js/35.ff2c9ad1.js"><link rel="prefetch" href="/documents/assets/js/36.45f29697.js"><link rel="prefetch" href="/documents/assets/js/37.1a0346b0.js"><link rel="prefetch" href="/documents/assets/js/38.60d0a1db.js"><link rel="prefetch" href="/documents/assets/js/4.25f6b541.js"><link rel="prefetch" href="/documents/assets/js/5.692bcc0a.js"><link rel="prefetch" href="/documents/assets/js/6.07df3592.js"><link rel="prefetch" href="/documents/assets/js/7.d13d6751.js"><link rel="prefetch" href="/documents/assets/js/8.e4409a99.js"><link rel="prefetch" href="/documents/assets/js/9.edf20759.js">
    <link rel="stylesheet" href="/documents/assets/css/0.styles.db21a181.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/documents/" class="home-link router-link-active"><!----> <span class="site-name">caihai123</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/documents/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/documents/record/" class="nav-link">
  记录文档
</a></div><div class="nav-item"><a href="/documents/plugin/" class="nav-link">
  收藏夹
</a></div><div class="nav-item"><a href="/documents/blog/" class="nav-link router-link-active">
  博客列表
</a></div> <a href="https://github.com/caihai123/documents" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/documents/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/documents/record/" class="nav-link">
  记录文档
</a></div><div class="nav-item"><a href="/documents/plugin/" class="nav-link">
  收藏夹
</a></div><div class="nav-item"><a href="/documents/blog/" class="nav-link router-link-active">
  博客列表
</a></div> <a href="https://github.com/caihai123/documents" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>博客列表</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/documents/blog/" aria-current="page" class="sidebar-link">介绍</a></li><li><a href="/documents/blog/图片懒加载与ajax懒加载.html" class="sidebar-link">图片懒加载和ajax懒加载</a></li><li><a href="/documents/blog/后端返回的long型数据丢失.html" class="sidebar-link">后端返回的long型数据丢失</a></li><li><a href="/documents/blog/网页背景水印代码记录.html" class="sidebar-link">网页背景水印</a></li><li><a href="/documents/blog/lodash的debounce仿抖动函数.html" class="sidebar-link">lodash的debounce仿抖动函数</a></li><li><a href="/documents/blog/es6模块.html" class="sidebar-link">export与import(ES6 module模快)</a></li><li><a href="/documents/blog/es6构造函数.html" class="sidebar-link">ES6构造函数</a></li><li><a href="/documents/blog/javascript原型.html" class="sidebar-link">详细记录js的原型链</a></li><li><a href="/documents/blog/HTTP Cache-Control 缓存机制.html" class="active sidebar-link">HTTP Cache-Control 缓存机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/documents/blog/HTTP Cache-Control 缓存机制.html#浏览器为什么会缓存" class="sidebar-link">浏览器为什么会缓存？</a></li><li class="sidebar-sub-header"><a href="/documents/blog/HTTP Cache-Control 缓存机制.html#浏览器是怎么缓存的" class="sidebar-link">浏览器是怎么缓存的？</a></li></ul></li><li><a href="/documents/blog/使用Travis CI自动部署GitHub Pages页面.html" class="sidebar-link">使用Travis CI自动部署GitHub Pages页面</a></li><li><a href="/documents/blog/前端数据字典最优方案.html" class="sidebar-link">前端数据字典的最优方案探索</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>以前只是知道浏览器会缓存静态文件，在不需要缓存时ctrl+F5刷新，为了方便用户可能还会在资源的路径后面添加一个版本号；直到现在我决定再把问题深入一点。主要有几个问题：浏览器为什么会缓存？浏览器是怎么缓存的？会缓存多久？扩展到前端性能优化该怎么做？以下是我对这几个问题的简单理解。</p> <h2 id="浏览器为什么会缓存"><a href="#浏览器为什么会缓存" class="header-anchor">#</a> 浏览器为什么会缓存？</h2> <p>当我们打开一个网页的时候，浏览器首先会通过链接（域名）获取到服务器上的一个html文件，然后浏览器再通过这个html去获取一些css，js，img等静态资源。但是如果每次访问这个页面浏览器都要去服务器下载一遍，是不是明显不太合理，浪费宽度，浪费时间，浪费服务器资源。所以最好的方式就是浏览器将这些文件储存在本地，第二次访问的时候就可以直接从本地获取。</p> <h2 id="浏览器是怎么缓存的"><a href="#浏览器是怎么缓存的" class="header-anchor">#</a> 浏览器是怎么缓存的？</h2> <blockquote><p>Cache-Control 通用消息头字段，被用于在http请求和响应中，通过指定指令来实现缓存机制。
首先说明一下，这个属性不是在前端代码里设置的，而是在服务器上；我们可以在本地安装个<code>nginx</code>做一些简单的验证。
常用参数有如下几个：</p></blockquote> <ul><li><code>private</code>(默认值)：</li></ul> <blockquote><p>表明响应只能被单个用户缓存，不能作为共享缓存（即代理服务器不能缓存它）。私有缓存可以缓存响应内容，比如：对应用户的本地浏览器。</p></blockquote> <p>这个是<code>Cache-Control</code>的默认值，当你在<code>NetWork</code>中没有看见相关响应头时实际就是这个。他的策略就是会在浏览器中缓存静态资源，具体缓存的时间与<code>Last-modified</code>有关，浏览器有自己的算法，不同浏览器得出的时间也不一样的。大致的规律就是文件经常修改，则缓存的时间越短。相对于默认值我觉得这是比较合理的。</p> <ul><li><code>public</code></li></ul> <blockquote><p>表明响应可以被任何对象（包括：发送请求的客户端，代理服务器，等等）缓存，即使是通常不可缓存的内容。（例如：1.该响应没有max-age指令或Expires消息头；2. 该响应对应的请求方法是 POST 。）</p></blockquote> <ul><li><code>no-store</code></li></ul> <blockquote><p>缓存不应存储有关客户端请求或服务器响应的任何内容，即不使用任何缓存。</p></blockquote> <p>当设置为<code>no-store</code>之后，浏览器不会做任何缓存，每次打开页面浏览器都会到服务器下载资源，这应该是最不常用的一种了。</p> <ul><li><code>no-cache</code></li></ul> <blockquote><p>在发布缓存副本之前，强制要求缓存把请求提交给原始服务器进行验证(协商缓存验证)。</p></blockquote> <p>协商缓存还和另外两个响应头有关系:<code>Last-Modified</code>（文件最后修改时间）和<code>ETag</code>（和文件数据相关的随机字符，文件改动时它也会改变，由服务器生成）。</p> <p>他的策略就是：第一次访问页面时将静态文件存储在本地，后面每次访问的时候都通过<code>If-Modified-Since</code>和<code>If-None-Match</code>到服务器端去做验证，如果文件已经修改了则重新下载，如果文件没有修改则返回304，浏览器会从本地读取。</p> <p>也就是说协商缓存虽然有缓存，但是每次都需要向服务器发送请求验证文件有没有修改。我个人认为只适用于html文件。</p> <ul><li><code>max-age=&lt;seconds&gt;</code></li></ul> <blockquote><p>设置缓存存储的最大周期，超过这个时间缓存被认为过期(单位秒)。与Expires相反，时间是相对于请求的时间。</p></blockquote> <p>强缓存。这个其实就很好理解了，就是设置一个缓存时间，只要时间没到，它永远都是从内存中读取。一般用来和版本号搭配起来使用（版本号的意思就是文件改变之后必须改变文件引用路径）。</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新：:</span> <span class="time">5/25/2020, 9:51:54 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/documents/blog/javascript原型.html" class="prev">
        详细记录js的原型链
      </a></span> <span class="next"><a href="/documents/blog/使用Travis CI自动部署GitHub Pages页面.html">
        使用Travis CI自动部署GitHub Pages页面
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/documents/assets/js/app.4f2ed955.js" defer></script><script src="/documents/assets/js/2.e76dce23.js" defer></script><script src="/documents/assets/js/21.9de72aab.js" defer></script>
  </body>
</html>
